<template>
  <v-container class="py-8">
    <v-row justify="center">
      <v-col cols="12" md="10">
        <v-card color="pink-darken-3" theme="dark" class="pa-6 mb-8 text-center" elevation="6">
          <v-icon size="64" class="mb-4">mdi-music-clef-treble</v-icon>
          <h1 class="text-h3 font-weight-bold mb-2">เทคนิคการจำด้วยบทเพลง</h1>
          <p class="text-subtitle-1">เรียนรู้คณิตศาสตร์และคอมพิวเตอร์ผ่านเสียงเพลง สนุกและจำแม่น!</p>
        </v-card>
      </v-col>
    </v-row>

    <v-row justify="center">
      <v-col cols="12" md="8">
        
        <v-card v-for="(song, index) in songs" :key="index" class="mb-6 rounded-xl song-card" elevation="3" border>
          <div class="d-flex flex-no-wrap justify-space-between">
            
            <div class="w-100 pa-4">
              <div class="d-flex align-center mb-2">
                <v-avatar color="pink-lighten-4" size="50" class="mr-4">
                  <span class="text-h6 font-weight-bold text-pink-darken-4">{{ index + 1 }}</span>
                </v-avatar>
                <div>
                  <v-card-title class="text-h6 font-weight-bold text-pink-darken-4 pa-0">
                    {{ song.title }}
                  </v-card-title>
                  <v-card-subtitle class="pa-0 text-caption">
                    {{ song.subtitle }}
                  </v-card-subtitle>
                </div>
              </div>

              <div class="mt-4 mb-2">
                <audio controls class="w-100 custom-audio"
                :ref="(el) => audioRefs[index] = el"
                @play="onPlay(index)">
                  <source :src="song.src" type="audio/mpeg">
                  Your browser does not support the audio element.
                </audio>
              </div>

              <div class="mt-2">
                <v-btn 
                  variant="text" 
                  color="grey-darken-1" 
                  class="px-0 text-capitalize"
                  @click="song.showLyrics = !song.showLyrics"
                >
                  <v-icon start>
                    {{ song.showLyrics ? 'mdi-chevron-up' : 'mdi-text-box-outline' }}
                  </v-icon>
                  {{ song.showLyrics ? 'ซ่อนเนื้อเพลง' : 'ดูเนื้อเพลง / เทคนิคการจำ' }}
                </v-btn>

                <v-expand-transition>
                  <div v-show="song.showLyrics">
                    <div class="mt-2 text-body-2 bg-pink-lighten-5 pa-4 rounded text-pink-darken-4">
                       <div style="white-space: pre-line;">{{ song.lyrics }}</div>
                    </div>
                  </div>
                </v-expand-transition>
              </div>

            </div>

            <v-avatar class="ma-3 hidden-sm-and-down" size="125" rounded="0">
              <v-icon size="80" :color="song.color">mdi-{{ song.icon }}</v-icon>
            </v-avatar>
          </div>
        </v-card>

      </v-col>
    </v-row>
  </v-container>
</template>

<script setup>
import { ref } from 'vue';

// แก้ไขจุดที่ 2: สร้างตัวแปรเก็บ Element Audio ทั้งหมด
const audioRefs = ref([]);

// แก้ไขจุดที่ 3: ฟังก์ชันสำหรับหยุดเพลงอื่น
const onPlay = (currentIndex) => {
  audioRefs.value.forEach((audio, index) => {
    // ถ้า index ไม่ใช่ตัวปัจจุบัน และ audio มีอยู่จริง ให้สั่งหยุด
    if (index !== currentIndex && audio) {
      audio.pause();
      // audio.currentTime = 0; // ถ้าอยากให้รีเซ็ตเพลงกลับไปเริ่มต้นด้วย ให้เอา comment ออก
    }
  });
};

const songs = ref([
  {
    title: "หน่วยที่ 1: ระบบจำนวนจริง",
    subtitle: "สมบัติของจำนวนจริงและการแยกตัวประกอบ",
    src: "/songs/unit1-real-number.mp3",
    icon: "math-compass",
    color: "primary",
    showLyrics: false, // [สำคัญ] ต้องเพิ่มตัวแปรนี้เพื่อคุมการเปิดปิดรายตัว
    lyrics: `จำนวนจริงมีอยู่หลายแบบ ฟังให้ชัดอย่าเผลอแวบ จำนวนเต็ม เศษส่วนมา อตรรกยะก็อยู่ตรงหน้า อยู่บนเส้นจำนวนเดียวกัน บวก ลบ คูณ หาร ใช้ได้ทุกวัน คณิตคอมไม่ใช่เรื่องไกล เข้าใจพื้นฐานก็ไปต่อได้
    \nจำนวนจริง จำให้ดี สมบัติมี อย่าลืมไป สลับที่ รวมกลุ่ม แจกแจง ใช้แก้โจทย์ได้ทุกวัน สมการ อสมการ ย้ายเป็นขั้น อย่าดันทุรัง คูณหรือหารด้วยลบเมื่อไร เครื่องหมายต้องกลับ จำไว้ให้ทัน 
    \nสมบัติของจำนวนจริง บวกคูณจริง ไม่เปลี่ยนค่า สลับที่ ผลเท่าเดิม รวมกลุ่มก็เหมือนเดิมทุกครา แจกแจงคูณเข้าไป ช่วยแยกตัวประกอบมา ศูนย์คือเอกลักษณ์บวก หนึ่งคือคูณ จำไว้หนา 
    \nจำนวนจริง จำให้ดี สมบัติมี อย่าลืมไป สลับที่ รวมกลุ่ม แจกแจง ใช้แก้โจทย์ได้ทุกวัน สมการ อสมการ ย้ายเป็นขั้น อย่าดันทุรัง คูณหรือหารด้วยลบเมื่อไร เครื่องหมายต้องกลับ จำไว้ให้ทัน 
    \nแยกตัวประกอบดึงตัวร่วม แจกแจงช่วยไม่ต้องกลัว เห็นกำลังสองเป็นรูป แยกเป็นคู่ได้ชัวร์ ๆ 
    \nสมการคือเท่ากัน ทำให้ x เด่นขึ้นมา อสมการไม่เท่ากัน ตอบเป็นช่วงบนเส้นค่า คิดเป็นขั้น ไม่ข้ามทาง ทำตามหลักไม่พลาดแน่ ท่องเป็นเพลงทุกวันไป สอบวันไหนก็ไหวแน่ ๆ 
    \nจำนวนจริงไม่หนี ถ้าจำเป็นเพลงแบบนี้ คณิตคอมไม่ต้องกลัว เข้าใจชัวร์ด้วยเสียงดนตรี`
  },
  {
    title: "หน่วยที่ 2: ระบบเลขฐาน",
    subtitle: "ฐานสอง ฐานแปด ฐานสิบ ฐานสิบหก",
    src: "/songs/unit2-number-systems.mp3",
    icon: "numeric",
    color: "teal",
    showLyrics: false,
    lyrics: `ระบบเลขฐาน ฟังให้ดี คอมพิวเตอร์ใช้วิธีนี้ ฐานสิบ คนใช้ทุกวัน แต่เครื่องมันใช้ฐานสองแทน ฐานสิบ ใช้ศูนย์ถึงเก้า ศูนย์หนึ่ง ฐานสองเท่านั้น ฐานแปด ศูนย์ถึงเจ็ดจำ ฐานสิบหก เพิ่ม A ถึง F 
    \nสอง แปด สิบ สิบหก จำให้ครบ อย่าสับสน เลขฐานคือค่าตำแหน่ง ยกกำลังฐาน อย่าลืมมัน ฐานอะไร ดูตัวเลข เกินฐานนั้น ใช้ไม่ได้ A คือสิบ B คือสิบเอ็ด จำไว้ใช้จริง ไม่หลงทาง 
    \nแปลงจากสิบ ไปฐานอื่น หารซ้ำ ๆ อย่าขัดขืน เอาเศษเรียงจากล่างขึ้น ได้คำตอบอย่าลืมฝืน จากฐานอื่น กลับฐานสิบ เอาเลขคูณ ยกกำลัง ตำแหน่งเริ่มจากศูนย์หลัง คำนวณตรง ไม่มีพัง 
    \nสอง แปด สิบ สิบหก จำให้ครบ อย่าสับสน เลขฐานคือค่าตำแหน่ง ยกกำลังฐาน อย่าลืมมัน ฐานสอง ใช้ศูนย์หนึ่ง ฐานสิบหก มี A ถึง F แปลงให้ชัวร์ ทีละขั้น สอบมาแบบไหน ก็เอาอยู่ 
    \nฐานสอง บวกก็ง่าย ศูนย์บวกศูนย์ ได้ศูนย์ไป หนึ่งบวกหนึ่ง ทดสองไว้ จำกติกา ไม่พลาดเลย ฐานสอง ลบก็คิด ยืมหนึ่งบิต ถ้าจำเป็น ระบบเลขฐาน ไม่ยากเย็น ถ้าท่องเป็นเพลงแบบนี้ 
    \nระบบเลขฐาน จำให้แม่น สอง แปด สิบ สิบหก แปลงฐานทำตามขั้น ไม่ต้องเดา ไม่ต้องจก คณิตคอม ถ้าเข้าใจ เลขฐานคือหัวใจมัน ท่องเป็นเพลงวันละรอบ สอบรอบไหน ก็ผ่านชัวร์`
  },
  {
    title: "หน่วยที่ 3: การคำนวณเลขฐาน",
    subtitle: "การบวก ลบ คูณ หาร และคอมพลีเมนต์",
    src: "/songs/unit3-calculation.mp3",
    icon: "calculator",
    color: "indigo",
    showLyrics: false,
    lyrics: `เลขฐานสอง ใช้ศูนย์กับหนึ่ง คอมพิวเตอร์คิดแบบนี้ทั้งนั้น ไม่ใช้เก้า ไม่ใช้แปด มีแค่ศูนย์หนึ่ง เรียงตามตำแหน่งมัน บวกเลขฐานสอง จำกติกา ศูนย์บวกศูนย์ ได้ศูนย์มา ศูนย์บวกหนึ่ง ได้หนึ่งทันที หนึ่งบวกหนึ่ง ทดหนึ่ง อย่าลืมดี ๆ 
    \nบวก บวก บวก เลขฐานสอง ทดขึ้นข้างหน้า ถ้าได้สอง ลบ ลบ ลบ เลขฐานสอง ยืมหนึ่งบิต ถ้ามันไม่พอ คิดทีละหลัก จากขวาไป ทำตามขั้น ไม่มั่ว ไม่เดา คณิตคอม ถ้าจำเพลงนี้ สอบกี่ที ก็เอาอยู่แล้ว 
    \nการลบเลขฐานสอง อย่าตกใจ ถ้าลบไม่ได้ ต้องยืมมา หนึ่งลบศูนย์ ได้หนึ่งไป ศูนย์ลบหนึ่ง ต้องยืมก่อนมา ยืมหนึ่งบิต เพิ่มค่าเป็นสอง แล้วลบต่อไป ทีละช่อง จำแค่นี้ ไม่ซับซ้อน คำนวณถูกแน่นอนทุกข้อ 
    \nบวก บวก บวก เลขฐานสอง ทดขึ้นข้างหน้า ถ้าได้สอง ลบ ลบ ลบ เลขฐานสอง ยืมหนึ่งบิต ถ้ามันไม่พอ คิดทีละหลัก จากขวาไป ทำตามขั้น ไม่มั่ว ไม่เดา คณิตคอม ถ้าจำเพลงนี้ สอบกี่ที ก็เอาอยู่แล้ว 
    \nไม่ใช่วิทย์ ไม่ใช่ฟิสิกส์ นี่คือเลขฐานของคอมพ์ ศูนย์กับหนึ่ง คือหัวใจ ของเครื่องจักรทั้งโลกกลม 
    \nหน่วยที่สาม การคำนวณ เลขฐานสอง ต้องแม่นให้ได้ บวกกับลบ ถ้าทำเป็น คณิตคอม ก็ไม่ยากอย่างใครว่าไว้ ท่องเป็นเพลง วันละรอบ ก่อนสอบไม่ต้องกลัวอะไร 20901 หนึ่งศูนย์ศูนย์สาม จำได้ชัวร์ ด้วยเพลงนี้`
  },
  {
    title: "หน่วยที่ 4: ตรรกศาสตร์",
    subtitle: "ประพจน์ ตัวเชื่อม และสัจนิรันดร์",
    src: "/songs/unit4-logic.mp3",
    icon: "head-lightbulb",
    color: "deep-purple",
    showLyrics: false,
    lyrics: `จริง และ จริง เท่ากับ จริง และ ต้องจริงพร้อมกัน เท็จ หรือ เท็จ เท่ากับ เท็จ หรือ เท็จล้วน ถึงจะเท็จนั้น 
    \nจริง และ จริง เท่ากับ จริง เท็จ หรือ เท็จ เท่ากับ เท็จ จริง ถ้าแล้ว เท็จ เท่ากับ เท็จ จำกรณีนี้ แค่กรณีเดียว จริง ก็ต่อเมื่อ จริง เท่ากับ จริง เหมือนกันเท่านั้น ถึงจะจริง ไม่ จริง เท่ากับ เท็จ กลับค่าทันที อย่าลืมสิ่งนี้ 
    \nและ ต้องจริงพร้อมกัน ขาดอย่างหนึ่ง เท็จทั้งหมด หรือ แค่มีจริงตัวเดียว คำตอบก็จริง ไม่ต้องคิดหมด ถ้าแล้ว จำให้ขึ้นใจ ผิดแค่กรณีเดียวเท่านั้น ถ้าจริงแล้วไม่ทำ ข้อนี้แหละ ผิดแน่นอนพลัน 
    \nจริง และ จริง เท่ากับ จริง เท็จ หรือ เท็จ เท่ากับ เท็จ จริง ถ้าแล้ว เท็จ เท่ากับ เท็จ จำกรณีนี้ แค่กรณีเดียว จริง ก็ต่อเมื่อ จริง เท่ากับ จริง เหมือนกันเท่านั้น ถึงจะจริง ไม่ จริง เท่ากับ เท็จ กลับค่าทันที อย่าลืมสิ่งนี้ 
    \nและ คือ ต้องจริงพร้อมกัน หรือ คือ มีจริงก็รอด ไม่ คือ กลับค่าทันที ถ้าแล้ว ผิดแค่จริงไปเท็จ ก็ต่อเมื่อ ต้องเหมือนกัน สูตรจำสั้น ๆ แค่นี้ หน่วยที่สี่ ตรรกศาสตร์ คณิตคอม บทนี้ผ่านชัวร์`
  },
  {
    title: "หน่วยที่ 5: พีชคณิตบูลีน",
    subtitle: "AND OR NOT และการลดรูปวงจร",
    src: "/songs/unit5-boolean.mp3",
    icon: "gate-and",
    color: "orange",
    showLyrics: false,
    lyrics: `บูลีนมีแค่สองค่า ศูนย์กับหนึ่ง เท่านั้นเอง ศูนย์คือเท็จ หนึ่งคือจริง จำให้ชัด อย่าสับสนเอง ตัวแปรบูลีน แทนค่าด้วย ศูนย์หรือหนึ่ง ตามระบบ เอามาคิดเป็นสมการ ย่อให้ง่าย ตามกฎครบ 
    \nหนึ่ง และ หนึ่ง ได้หนึ่ง ขาดศูนย์เมื่อไร เป็นศูนย์ทัน ศูนย์ หรือ ศูนย์ ได้ศูนย์ มีหนึ่งเมื่อไร ผ่านเหมือนกัน ไม่ ศูนย์ เป็นหนึ่ง ไม่ หนึ่ง กลับเป็นศูนย์ สามกฎนี้ คือหัวใจ ของพีชคณิตบูลีน 
    \nวงจรตรรกะ ทำตามค่า ศูนย์หนึ่ง วิ่งผ่านประตู ประตูและ คิดแบบเข้ม ต้องหนึ่งคู่ ถึงจะรู้ ประตูหรือ ใจกว้างกว่า มีหนึ่งมา ก็ผ่านไป ประตูไม่ กลับค่าทัน ศูนย์เป็นหนึ่ง เข้าใจไหม 
    \nหนึ่ง และ หนึ่ง ได้หนึ่ง ขาดศูนย์เมื่อไร เป็นศูนย์ทัน ศูนย์ หรือ ศูนย์ ได้ศูนย์ มีหนึ่งเมื่อไร ผ่านเหมือนกัน ไม่ ศูนย์ เป็นหนึ่ง ไม่ หนึ่ง กลับเป็นศูนย์ สามกฎนี้ คือหัวใจ ของพีชคณิตบูลีน 
    \nแนนด์ คือ ไม่ของและ นอร์ คือ ไม่ของหรือ ดูสมการให้แตกออก รู้ทันที ใช้ประตูคือ 
    \nศูนย์คือเท็จ หนึ่งคือจริง บูลีนคิดแค่นี้พอ สมการไป วงจรตาม จำให้ครบ ใช้สอบรอด บทนี้ใหม่ ไม่ปนเก่า พีชคณิตบูลีน ล้วน ๆ คณิตคอม ถ้าท่องเพลงนี้ บทนี้เอาอยู่ แน่นอน`
  },
  {
    title: "หน่วยที่ 6: เมทริกซ์",
    subtitle: "การคูณ ดีเทอร์มิแนนต์ และอินเวอร์ส",
    src: "/songs/unit6-matrix.mp3",
    icon: "matrix",
    color: "cyan",
    showLyrics: false,
    lyrics: `เมทริกซ์ คือกล่องของตัวเลข เรียงเป็นแถว เป็นหลัก ให้เห็นชัด แถวอยู่แนวนอน หลักตั้งตรง จำรูปแบบนี้ไว้ก่อน เริ่มต้นเรียนมัน ขนาดเมทริกซ์ ดูแถวดูหลัก แถวคูณหลัก เขียนกำกับ สองคูณสาม หรือสามคูณสอง สลับกันไม่ได้ ต้องดูให้ตรง 
    \nแถวมาก่อน หลักตามหลัง จำให้มั่น อย่าสลับทาง เมทริกซ์ ไม่ใช่เลขเดี่ยว แต่เป็นกลุ่มเดียว ที่คิดเป็นระบบ 
    \nบวกเมทริกซ์ ต้องขนาดเท่ากัน แถวเท่ากัน หลักต้องตรง เอาตัวที่อยู่ตำแหน่งเดียว มาบวกกันไป ทีละช่อง ลบก็เหมือนกัน หลักเดียวกัน คิดตามตำแหน่ง อย่าสับสน ถ้าขนาดไม่เท่ากัน ข้อนี้ทำไม่ได้ จำให้ทน 
    \nบวกกับลบ ขนาดต้องเท่า ตำแหน่งเดียวกัน เอามารวม เมทริกซ์ คิดเป็นช่อง ๆ ไม่ใช่เดาสุ่ม ต้องคิดเป็นระบบ 
    \nคูณด้วยจำนวน ทำง่ายหน่อย เอาเลขนั้น คูณทุกตัว ทุกแถว ทุกหลัก ไม่ต้องกลัว คูณให้ทั่ว ทั้งเมทริกซ์ไป แต่คูณเมทริกซ์ ต้องดูให้ดี หลักของตัวหน้า ต้องเท่าตัวหลัง แถวของผล จะมาจากตัวหน้า หลักของผล มาจากตัวหลัง 
    \nคูณเมทริกซ์ อย่าลืมดู หลักหน้าเท่าหลัง ถึงจะคูณได้ ผลลัพธ์ ขนาดใหม่ จำสูตรนี้ไว้ ใช้สอบได้จริง [Bridge] เมทริกซ์ ไม่ยากอย่างคิด ถ้าจำกติกา เป็นขั้นเป็นตอน ดูแถว ดูหลัก ก่อนลงมือ ทำตามขั้นตอน ก็ไม่พังแน่นอน 
    \nเมทริกซ์ คือหัวใจบทนี้ แถวกับหลัก ต้องจำให้ได้ บวก ลบ คูณ ถ้ารู้กฎ หน่วยที่หก ก็ผ่านไปได้ เรียงตัวเลข เป็นระบบ คิดเป็นขั้น ไม่หลงทาง เมทริกซ์ ถ้าร้องเป็นเพลง บทนี้เอง ก็เอาอยู่`
  },
  // {
  //   title: "Test Song 1",
  //   subtitle: "Test Subtitle 1",
  //   src: "/songs/Her.mp3",
  //   icon: "test-tube",
  //   color: "error",
  //   showLyrics: false,
  //   lyrics: `This is a test song lyric 1...\nLine 2 of the lyrics...\nLine 3 of the lyrics...`
  // },
]);
</script>

<style scoped>
.custom-audio {
  height: 40px;
  border-radius: 20px;
  outline: none;
}

.song-card {
  transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
  /* เพิ่ม will-change เพื่อบอก Browser ให้เตรียม render การเคลื่อนไหว */
  will-change: transform, box-shadow; 
}

.song-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 16px rgba(0,0,0,0.12) !important;
}
</style>